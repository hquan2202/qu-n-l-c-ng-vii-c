<div class="popup-container">
  <div class="popup-content">

    <div class="header">
      <div class="h3"><h3>Create board</h3></div>
      <mat-icon class="close-btn" (click)="closePicker()">close</mat-icon>
    </div>

    <div
      class="preview"
      [ngStyle]="{
        'background': selectedBackground.startsWith('http')
          ? 'url(' + selectedBackground + ') center/cover'
          : selectedBackground
      }">
    </div>

    <div class="section">
      <label>Background</label>
      <div class="background-options">
        <img *ngFor="let bg of backgrounds" [src]="bg" (click)="selectBackground(bg)"
             [class.selected]="selectedBackground === bg">
      </div>
      <div class="gradient-options">
        <div *ngFor="let bg of gradientBackgrounds" class="gradient-tile"
             [ngStyle]="{'background': bg}" (click)="selectBackground(bg)"
             [class.selected]="selectedBackground === bg">
        </div>
        <div class="gradient-tile more-tile" (click)="togglePicker()">...</div>
      </div>

      <app-background-picker *ngIf="showPicker"
                             (selectBackground)="onBackgroundSelected($event)"
                             (close)="togglePicker()">
      </app-background-picker>
    </div>

    <div class="section">
      <label>Board Title <span class="required">*</span></label>
      <input type="text" [(ngModel)]="boardTitle" placeholder="Enter board title..." required
             #titleInput="ngModel" [class.input-error]="titleInput.invalid && titleInput.touched" />
    </div>

    <div class="section invite-section">
      <label>Members</label>

      <div class="invite-link-box">
        <div class="link-content">
          <mat-icon class="link-icon">link</mat-icon>
          <div class="link-text">
            <span>Invite with link</span>
            <small class="link-url">trello-clone/invite...</small>
          </div>
        </div>
        <button class="copy-btn" (click)="copyLink()">
          {{ isLinkCopied ? 'Copied!' : 'Copy' }}
        </button>
      </div>

      <div class="add-member-controls">
        <div class="or-divider">or</div>
        <div class="email-input-group" style="margin-top: 8px;">
          <input type="email" [(ngModel)]="emailInput" (keydown.enter)="addEmail()"
                 placeholder="email@example.com">
          <button class="add-btn" [disabled]="!emailInput" (click)="addEmail()">Add</button>
        </div>
      </div>

      <div class="selected-members-list" *ngIf="selectedMembers.length > 0">
        <div class="member-chip" *ngFor="let member of selectedMembers"
             [class.is-email]="member.type === 'email'">

          <div class="avatar">
            <span *ngIf="member.type === 'user'">{{ member.name.charAt(0).toUpperCase() }}</span>
            <mat-icon *ngIf="member.type === 'email'">mail</mat-icon>
          </div>

          <span class="member-name">{{ member.name }}</span>
          <mat-icon class="remove-icon" (click)="removeMember(member)">close</mat-icon>
        </div>
      </div>
    </div>

    <div class="section">
      <label>Visibility</label>
      <select [(ngModel)]="selectedVisibility">
        <option value="workspace">Workspace (Company)</option>
        <option value="personal">Personal (Private)</option>
      </select>

      <div class="helper-text">
        <span *ngIf="selectedVisibility === 'workspace'">Visible to everyone in your workspace.</span>
        <span *ngIf="selectedVisibility === 'personal'">Only you and invited members can see this.</span>
      </div>
    </div>

    <div class="actions">
      <button class="create-btn" (click)="onCreateBoard()" [disabled]="!boardTitle">
        Create Board
      </button>
    </div>

  </div>
</div>
